# spark-demo

**日计算留存率**
* 留存率=新增用户中登录用户数/新增用户数*100%（一般统计周期为天）
* 新增用户数：在某个时间段（一般为第一整天）新登录应用的用户数；
* 登录用户数：登录应用后至当前时间，至少登录过一次的用户数；
* 第N日留存：指的是新增用户日之后的第N日依然登录的用户占新增用户的比例
* 第1日留存率（即“次留”）：（当天新增的用户中，新增日之后的第1天还登录的用户数）/第一天新增总用户数；
* 第2日留存率：（当天新增的用户中，新增日之后的第2天还登录的用户数）/第一天新增总用户数；
* 第3日留存率：（当天新增的用户中，新增日之后的第3天还登录的用户数）/第一天新增总用户数；
* 第7日留存率：（当天新增的用户中，新增日之后的第7天还登录的用户数）/第一天新增总用户数；
* 第30日留存率：（当天新增的用户中，新增日之后的第30天还登录的用户数）/第一天新增总用户数；

**思路：**
* 拿到用户的所有登录时间（用户的登录记录都在hadoop上）
* 增加一列用户的首次登陆时间（实际情况，可以增加一个用户登录记录表）
* 增加一列用户登录的时间差 （计算出时间差，按日记）
* 增加几列case when 获取业务留存天数
* 计算留存与所用用户比例